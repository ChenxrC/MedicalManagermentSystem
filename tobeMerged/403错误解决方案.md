# 403错误解决方案 - 提交考试失败问题

## 🔍 问题分析

您遇到的403 Forbidden错误是因为**权限问题**。具体原因是：

1. **testuser账号没有被分配考试** - 系统检查发现该学员没有被分配任何考试
2. **权限验证失败** - 后端API要求学员必须有考试分配才能提交答案

## 🛠️ 解决方案

### 方案1：使用现有学员账号（推荐）

根据数据库中的学员信息，您可以使用以下账号进行测试：

#### 学员账号（密码 = 用户名）
- **用户名**: `user001`，**密码**: `user001`
- **用户名**: `user002`，**密码**: `user002`  
- **用户名**: `user003`，**密码**: `user003`
- **用户名**: `user004`，**密码**: `user004`

#### 测试账号
- **用户名**: `testuser`，**密码**: `testuser123`

### 方案2：为testuser分配考试

如果您想继续使用testuser账号，需要为其分配考试：

1. **运行密码重置脚本**：
```bash
cd backend
python ../reset_user_passwords.py
```

2. **运行考试分配检查脚本**：
```bash
cd backend
python ../check_exam_assignments.py
```

3. **手动分配考试**（通过管理后台或API）

### 方案3：创建新的测试账号

如果需要创建新的测试账号，可以使用以下脚本：

```python
# 在Django shell中执行
from django.contrib.auth.models import User
from exams.models import Student, Exam, ExamStudentAssignment

# 创建用户
user = User.objects.create_user(
    username='newtest',
    email='newtest@example.com',
    password='newtest123'
)

# 创建学员记录
student = Student.objects.create(
    user=user,
    student_id='newtest001',
    name='新测试学员',
    email='newtest@example.com',
    department='测试部门',
    major='测试专业',
    grade='2024级',
    phone='13800138000'
)

# 分配考试
exam = Exam.objects.filter(is_active=True).first()
if exam:
    assignment = ExamStudentAssignment.objects.create(
        exam=exam,
        student=student,
        assigned_by=User.objects.first()
    )
    print(f"成功分配考试: {exam.title} -> {student.name}")
```

## 🧪 测试步骤

### 1. 使用学员账号测试

1. **访问登录页面**：`http://localhost:8080/student-login`
2. **输入账号信息**：
   - 用户名：`user001`
   - 密码：`user001`
3. **登录后查看考试列表**
4. **选择考试进行答题**
5. **提交答案测试**

### 2. 验证权限

登录后，检查以下内容：
- ✅ 能看到考试列表
- ✅ 能进入考试答题界面
- ✅ 能正常提交答案
- ✅ 不出现403错误

## 🔧 技术细节

### 权限检查逻辑

后端API的权限检查逻辑：

```python
# 检查学员是否被分配了这份考试
assignment = ExamStudentAssignment.objects.filter(
    exam=exam,
    student__user=student,
    is_active=True
).first()

if not assignment:
    return Response({'error': '您没有被分配这份考试'}, status=status.HTTP_403_FORBIDDEN)
```

### 数据库关系

- `User` - 用户账号
- `Student` - 学员信息（关联User）
- `Exam` - 考试信息
- `ExamStudentAssignment` - 考试分配关系
- `Score` - 成绩记录

## 📝 常见问题

### Q1: 为什么会出现403错误？
A: 因为学员没有被分配考试，系统认为没有权限提交答案。

### Q2: 如何知道哪些学员有考试分配？
A: 运行 `check_exam_assignments.py` 脚本查看分配情况。

### Q3: 如何为学员分配考试？
A: 通过管理后台或API为学员分配考试。

### Q4: 密码忘记了怎么办？
A: 运行 `reset_user_passwords.py` 脚本重置密码。

## 🚀 快速修复

如果您想快速解决这个问题，建议：

1. **使用现有学员账号**：`user001` / `user001`
2. **或者重置testuser密码**：运行重置脚本
3. **为testuser分配考试**：通过管理后台操作

## 📞 技术支持

如果问题仍然存在，请提供：
1. 使用的具体账号信息
2. 完整的错误日志
3. 数据库检查结果
4. 浏览器开发者工具截图
