# 试卷分配界面问题排查指南

## 问题描述
在管理员界面的试卷分配界面，读不到学员信息和试卷信息。

## 问题原因分析

### 1. API调用问题
- **问题**: 前端使用了`fetch`而不是`axios`进行API调用
- **影响**: 可能导致请求头、错误处理等问题
- **解决**: 已修复为使用`axios`

### 2. 数据库数据问题
- **问题**: 数据库中可能没有学员和试卷数据
- **影响**: API返回空数据，前端显示空白
- **解决**: 需要创建测试数据

### 3. API端点问题
- **问题**: 后端API端点可能不存在或配置错误
- **影响**: 前端请求失败
- **解决**: 检查API配置

## 已修复的问题

### 1. 前端API调用修复

#### AssignmentManagement.vue
- **修复内容**: 
  - 将`fetch`调用改为`axios`调用
  - 添加`axios`导入
  - 修复错误处理逻辑

#### 具体修改：
```javascript
// 修复前
const [assignmentsResponse, examsResponse, studentsResponse] = await Promise.all([
  fetch('/api/exam-assignments/', {
    method: 'GET',
    headers: { 'Content-Type': 'application/json' },
  }),
  // ...
])

// 修复后
const [assignmentsResponse, examsResponse, studentsResponse] = await Promise.all([
  axios.get('/api/exam-assignments/'),
  axios.get('/api/exams/'),
  axios.get('/api/students/')
])
```

### 2. 后端API配置检查

#### 确认存在的API端点：
- `/api/students/` - 学员管理API
- `/api/exams/` - 试卷管理API  
- `/api/exam-assignments/` - 试卷分配API

#### 确认存在的ViewSet：
- `StudentViewSet` - 学员管理视图集
- `ExamViewSet` - 试卷管理视图集
- `ExamStudentAssignmentViewSet` - 试卷分配视图集

#### 确认存在的序列化器：
- `StudentSerializer` - 学员序列化器
- `ExamSerializer` - 试卷序列化器
- `ExamStudentAssignmentSerializer` - 试卷分配序列化器

## 验证步骤

### 1. 检查后端服务
确保后端服务正在运行：
```bash
cd backend
python manage.py runserver
```

### 2. 检查数据库数据
运行数据库检查脚本：
```bash
python check_assignment_data.py
```

### 3. 测试API端点
运行API测试脚本：
```bash
python test_assignment_api.py
```

### 4. 检查前端控制台
打开浏览器开发者工具，查看Network标签页：
- 检查API请求是否成功
- 查看请求和响应状态
- 检查是否有错误信息

## 常见问题及解决方案

### 1. 数据库为空
**问题**: 没有学员或试卷数据
**解决**: 
```bash
python check_assignment_data.py
```
该脚本会自动创建测试数据

### 2. API请求失败
**问题**: 前端无法获取数据
**解决**: 
- 检查后端服务是否运行
- 检查API端点是否正确
- 查看浏览器控制台错误信息

### 3. 权限问题
**问题**: API返回403错误
**解决**: 
- 检查用户认证状态
- 确认用户有管理员权限

### 4. 跨域问题
**问题**: 前端请求被CORS阻止
**解决**: 
- 检查Django CORS配置
- 确认前端和后端端口配置

## 测试数据创建

如果数据库中没有数据，可以使用以下方法创建：

### 1. 使用检查脚本
```bash
python check_assignment_data.py
```

### 2. 手动创建数据
```python
# 在Django shell中执行
python manage.py shell

from django.contrib.auth.models import User
from exams.models import Student, Exam, ExamStudentAssignment

# 创建用户
user = User.objects.create_user(username='admin', password='admin123')

# 创建学员
student = Student.objects.create(
    user=user,
    student_id='2021001',
    name='测试学员',
    email='test@example.com'
)

# 创建试卷
exam = Exam.objects.create(
    title='测试试卷',
    description='这是一个测试试卷',
    created_by=user,
    is_active=True
)

# 创建分配
assignment = ExamStudentAssignment.objects.create(
    exam=exam,
    student=student,
    assigned_by=user
)
```

## 调试技巧

### 1. 浏览器开发者工具
- 打开Network标签页
- 查看API请求的详细信息
- 检查请求URL和响应状态
- 查看响应数据格式

### 2. 后端日志
- 查看Django服务器日志
- 检查是否有错误信息
- 验证请求是否到达后端

### 3. 数据库查询
- 使用Django shell检查数据
- 验证模型关系是否正确
- 检查数据完整性

## 预防措施

1. **统一API调用**: 使用axios进行所有API调用
2. **错误处理**: 添加完善的错误处理机制
3. **数据验证**: 在创建数据前进行验证
4. **日志记录**: 添加详细的日志记录

## 联系支持

如果问题仍然存在，请提供以下信息：
1. 完整的错误日志
2. 数据库检查结果
3. API测试结果
4. 浏览器开发者工具截图
5. 后端服务器日志
